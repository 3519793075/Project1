# Project1
乡村致贫数据分析

1.1 背景： 

基于农村居民个人家庭经济情况数据，建立农村居民个人信息库，设计数据比对标准和信息预警机制，判断其是否需要纳入返贫监测对象及是否有返贫风险。建立诸如根据医保数据判断农村居民每月用于医疗的开销大于一定金额则判定该农村居民为易返贫户等预警规则。

请以基于乡村振兴数据建立数据挖掘模型，通过模型分析并建立设置预警规则，分析比对数据，动态发起风险预警，调整农村居民风险评估。

 

1.2 需求：

1、将乡村振兴数据进行已处理并可视化，分析数据的特征；

2、根据数据特征并结合实际情况，选择并建立数据挖掘模型；

3、根据模型给出设置预警规则，分析设计数据比对标准，对农村居民进行返贫致贫风险评估。

 

分析所给的表以及表中数据，在该案例中我们选取T_XCZXJ_JTCYXX表(家庭成员信息表)与T_XCZXJ_JTXX表(家庭信息表)来进行数据探索、数据处理以及模型建立步骤来建立正确的模型来判断一个家庭是否会致贫。选取了T_XCZXJ_YBSJXX表(医保数据信息)来根据医保自付金额来判断该人是否会返贫。接下来就是对上述三个表的处理过程。

 

***\*2.\**** ***\*数据探索\****

数据探索是拿到数据要做的第一步，目的是对要分析的数据有个大概的了解。弄清数集质量，大小，特征和样本数量，数据类型，数据的概率分布等。数据探索主要包括：数据质量探索、数据特征分析。

数据质量探索顾名思义，就是了解数据的大体质量，常见的数据问题比如缺失，异常值与数据不一致。数据特征分析包括分布情况（可以绘制频率分布直方图hist***\*，\****条形图***\*，\****饼图pie）。

对比分析：了解相互联系的指标的变化情况对比，考虑使用折线图plot。统计量分析：集中趋势分析：平均数data.mean()，中位数data.median()，众数。离散程度分析：极差，标准差data.std()，变异系数。变异系数=（标准差 / 平均数）×100%***\*，\****用来比较不同单位的数据的离散程度，而标准差一般用于比较相同单位。相关性分析：一般来说可以通过绘制散点图，来分析2个变量间的相关性。

 

2.1 属性探索

根据乡村振兴内的家庭信息、家庭成员信息以及医保信息等详细数据，家庭信息表共35075条数据，家庭成员信息表共53030条数据，医保信息表共500条数据。其中包含了户主姓名、户主身份证、致贫原因、家庭信息表id、成员姓名、文化程度、在校生状况、健康状况、残疾等级、残疾类别、劳动技能等属性，如下表所示。

 

2.1.1、家庭信息表字段：

| 英文表名 | T_XCZXJ_JTXX               |            |          |      |               |
| -------- | -------------------------- | ---------- | -------- | ---- | ------------- |
|          | 家庭信息表(只显示户主信息) |            |          |      |               |
| 中文表名 | 字段名称                   | 字段描述   | 字段类型 | 长度 | 是否主键/索引 |
| 序号     | ID                         | 主键       | VARCHAR2 | 20   | 主键          |
| 1        | HZXM                       | 户主姓名   | VARCHAR2 | 20   |               |
| 2        | HZSFZ                      | 户主身份证 | VARCHAR2 | 18   |               |
| 3        | ZPYY                       | 致贫原因   | VARCHAR2 | 32   |               |
| 4        | CREATE_TIME                | 创建时间   | DATE     | 7    |               |

 

2.1.2、家庭信息表(前五行)：

| ID    | HZXM   | HZSFZ              | ZPYY |
| ----- | ------ | ------------------ | ---- |
| 10437 | 丑兼紊 | 22060020010104437X |      |
| 10216 | 初凑茂 | 2.21E+17           |      |
| 10218 | 熊小苗 | 2.21E+17           |      |
| 10219 | 熊襄府 | 2.21E+17           |      |
| 1022  | 错赫襄 | 3.42E+17           |      |

 

在家庭信息表中有家庭ID(主键，和后面家庭成员信息表中ID相同的话即为同一个家庭)，致贫原因（这是我们认定一个家庭是否为贫困家庭的标签）大部分为空，即是不贫困。

 

2.2.1、家庭成员信息表

| 英文表名 | T_XCZXJ_JTCYXX |                                                              |          |      |               |
| -------- | -------------- | ------------------------------------------------------------ | -------- | ---- | ------------- |
| 中文表名 | 家庭成员信息表 |                                                              |          |      |               |
| 序号     | 字段名称       | 字段描述                                                     | 字段类型 | 长度 | 是否主键/索引 |
| 1        | MEMBER_ID      | 主键                                                         | VARCHAR2 | 20   | 主键          |
| 2        | JTXX_ID        | 家庭信息表id                                                 | VARCHAR2 | 20   |               |
| 3        | CYXM           | 成员姓名                                                     | VARCHAR2 | 20   |               |
| 4        | CYSFZ          | 成员身份证                                                   | VARCHAR2 | 18   |               |
| 5        | WHCD           | 文化程度                                                     | VARCHAR2 | 4    |               |
| 6        | ZXSZK          | 在校生状况                                                   | VARCHAR2 | 64   |               |
| 7        | JKZK           | 健康状况                                                     | VARCHAR2 | 64   |               |
| 8        | CJDJ           | 残疾等级                                                     | VARCHAR2 | 64   |               |
| 9        | CJLB           | 残疾类别                                                     | VARCHAR2 | 64   |               |
| 10       | LDJN           | 劳动技能（1技能劳动力 2普通劳动力 3弱劳动力或半劳动力 4丧失劳动力 5无劳动力） | VARCHAR2 | 255  |               |
| 16       | YHZGX          | 与户主关系                                                   | VARCHAR2 | 20   |               |
| 17       | SFSW           | 是否死亡（0 死亡 1存活）                                     | VARCHAR2 | 2    |               |

 

2.2.2、家庭成员信息表（前五行）

| MEMBER_ID | MEMBER_ID | MEMBER_ID | MEMBER_ID | WHCD | ZXSZK | JKZK | CJDJ | CJLB | LDJN | YHZGX | SFSW |
| --------- | --------- | --------- | --------- | ---- | ----- | ---- | ---- | ---- | ---- | ----- | ---- |
| 1063      | 405       | 熊贤艳    | 3.42E+17  |      |       | 1    |      |      | 2    | 1     | 1    |
| 10630     | 4269      | 江廉主    | 2.21E+17  |      |       | 4    | 四级 | 2    | 4    | 21    | 1    |
| 10631     | 4270      | 江叹棉    | 2.21E+17  |      |       | 1    |      |      | 3    | 1     | 1    |
| 10632     | 4271      | 江忍伤    | 2.21E+17  |      |       | 2    |      |      | 3    | 1     | 1    |
| 10633     | 4272      | 坚弹英    | 2.21E+17  |      |       | 2    |      |      | 5    | 1     | 1    |

 

在家庭成员信息表中，包括了身份证号、姓名等与致贫无关的信息，也有WHCD（文化程度）、

ZXSZK（在校生状况）、JKZK（健康状况）、CJDJ（残疾等级）、CJLB（残疾类别）等有较大关系的信息。后面主要对这些信息进行数据处理和建模分析。

 

2.3.3、医保数据信息表

| 英文表名 | T_XCZXJ_YBSJXX    |                        |          |      |               |
| -------- | ----------------- | ---------------------- | -------- | ---- | ------------- |
| 中文表名 | 医疗部门信息      |                        |          |      |               |
| 序号     | 字段名称          | 字段描述               | 字段类型 | 长度 | 是否主键/索引 |
| 1        | ID                | 主键                   | NUMBER   | 20   | 主键          |
| 2        | AAA027            | AAA027                 | VARCHAR2 | 20   |               |
| 3        | XM                | 姓名                   | VARCHAR2 | 40   |               |
| 4        | SFZH              | 身份证                 | VARCHAR2 | 255  |               |
| 7        | YLFZE             | 医疗费总额             | NUMBER   | 20   |               |
| 8        | KBFY              | 可报费用               | NUMBER   | 20   |               |
| 9        | JBYBZF            | 基本医保支付           | NUMBER   | 20   |               |
| 10       | DBBX              | 大病报销金额           | NUMBER   | 20   |               |
| 11       | NBX               | 健康扶贫政策内报销金额 | NUMBER   | 20   |               |
| 12       | WBX               | 健康扶贫政策外报销金额 | NUMBER   | 20   |               |
| 13       | YLJZ              | 医疗救助               | NUMBER   | 20   |               |
| 14       | CZDD              | 财政兜底               | NUMBER   | 20   |               |
| 15       | DDJGCD            | 定点机构承担           | NUMBER   | 20   |               |
| 16       | GRZF              | 个人自付               | NUMBER   | 20   |               |
| 19       | CJSJ              | 创建时间               | DATE     | 7    |               |
| 20       | LAST_UPDATE_DTIME | 数据最后修改时间       | DATE     | 7    |               |
| 21       | CHECK_TIME        | 核验时间               | DATE     | 7    |               |

 

2.3.3、医保数据信息表前五行

| ID   | AAA027 | XM     | SFZH     | BMID | XXDZ                            | YLFZE  | KBFY   | JBYBZF | DBBX  | NBX  | WBX  | YLJZ | CZDD | DDJGCD | GRZF   |
| ---- | ------ | ------ | -------- | ---- | ------------------------------- | ------ | ------ | ------ | ----- | ---- | ---- | ---- | ---- | ------ | ------ |
| 5174 | 360502 | 野苗锯 | 2.21E+17 | 284  | 山东省德州市陵城区前门大街974号 | 35014  | 34214  | 12936  | 1277  | 0    | 0    | 0    | 0    | 0      | 20861  |
| 5175 | 360502 | 闻小苗 | 2.21E+17 | 290  | 山东省德州市陵城区前门大街288号 | 46787  | 30980  | 18168  | 0     | 0    | 0    | 0    | 0    | 0      | 28648  |
| 5161 | 360502 | 律尹姥 | 2.21E+17 | 288  | 山东省德州市陵城区前门大街444号 | 90185  | 52595  | 31375  | 1289  | 0    | 0    | 0    | 61   | 0      | 57550  |
| 5162 | 360502 | 哈嵌绣 | 2.21E+17 | 288  | 山东省德州市陵城区前门大街444号 | 169330 | 65042  | 38605  | 4372  | 0    | 0    | 0    | 0    | 0      | 126413 |
| 5163 | 360502 | 熊衰灼 | 2.21E+17 | 288  | 山东省德州市陵城区前门大街444号 | 127333 | 108804 | 63998  | 15394 | 0    | 0    | 0    | 0    | 0      | 48001  |

 

在医疗信息表中，重要的信息在于GRZF（个人自付），如果数额较大，超过一般值，我们认为很有可能医疗致贫。

 

2.2 描述性统计分析

通过对原始数据观察发现数据中存在某些属性有大量空值的情况空值的，由于这里几万条数据记录，我们需要相关的具体描述。

根据代码得到的探索，结果如下图。这里有大量空值，包括一些关键的，可能会直接导致贫困的因素，比如ZXSZK(在校生状况，可能引起教育致贫)、CJDJ和CJLB(残疾等级和残疾类别，可能引起残疾致贫)

![img](file:///C:\Users\锦程\AppData\Local\Temp\ksohtml2100\wps1.jpg) 

2.3 医保数据信息 用户自付金额分析

在医保数据中，我们对自付金额数据绘制了箱线图，超过上四分线的即认为是数额过大，认为存在致贫风险。

![img](file:///C:\Users\锦程\AppData\Local\Temp\ksohtml2100\wps2.jpg) 

从图中，我们不难发现上四分位线在八千左右，而在自付金额数据中有大量超过这个正常值界限，甚至有高达两万六的金额，这些我们认为是有大病致贫风险。在这里我们获取到自付金额超额的家庭的ID号，保存到新的一个“致贫风险家庭表1”中，此外以个人自付金额除以上四分位取模，作为该家庭医疗致贫风险的等级划分。

2.4 总家庭致贫率计算

所有数据中，进行总致贫率计算。我们获取到家庭信息表中致贫原因非空的数量，除以数据总数即得出总共家庭致贫率。

结果为：0.022066。



***\*3.\*******\*数据处理\****

数据预处理（data preprocessing）是指在主要的处理以前对数据进行的一些处理。数据的质量，直接决定了模型的预测和泛化能力的好坏。它涉及很多因素，包括：准确性、完整性、一致性、时效性、可信性和解释性。而在真实数据中，我们拿到的数据可能包含了大量的缺失值，可能包含大量的噪音，也可能因为人工录入错误导致有异常点存在，非常不利于算法模型的训练。数据清洗的结果是对各种脏数据进行对应方式的处理，得到标准的、干净的、连续的数据，提供给数据统计、数据挖掘等使用。

 

3.1 数据归约

数据归约技术可以用来得到数据集的归约表示，它小得多，但仍接近地保持原数据的完整性。 这样，在归约后的数据集上挖掘将更有效，并产生相同(或几乎相同)的分析结果。一般有如下策略：

1、维度规约

用于数据分析的数据可能包含数以百计的属性，其中大部分属性与挖掘任务不相关，是冗余的。维度归约通过删除不相关的属性，来减少数据量，并保证信息的损失最小。

***\*属性子集选择：\****目标是找出最小属性集，使得数据类的概率分布尽可能地接近使用所有属性的原分布。在压缩 的属性集上挖掘还有其它的优点。它减少了出现在发现模式上的属性的数目，使得模式更易于理解。

· 逐步向前选择：该过程由空属性集开始，选择原属性集中最好的属性，并将它添加到该集合
中。在其后的每一次迭代，将原属性集剩下的属性中的最好的属性添加到该集合中。 

· 逐步向后删除：该过程由整个属性集开始。在每一步，删除掉尚在属性集中的最坏属性。

· 向前选择和向后删除的结合：向前选择和向后删除方法可以结合在一起，每一步选择一个最 好的属性，并在剩余属性中删除一个最坏的属性。

python scikit-learn 中的递归特征消除算法Recursive feature elimination (RFE)，就是利用这样的思想进行特征子集筛选的，一般考虑建立SVM或回归模型。

***\*单变量重要性：\****分析单变量和目标变量的相关性，删除预测能力较低的变量。这种方法不同于属性子集选择，通常从统计学和信息的角度去分析。

· pearson相关系数和卡方检验，分析目标变量和单变量的相关性。

· 回归系数：训练线性回归或逻辑回归，提取每个变量的表决系数，进行重要性排序。

· 树模型的Gini指数：训练决策树模型，提取每个变量的重要度，即Gini指数进行排序。

· Lasso正则化：训练回归模型时，加入L1正则化参数，将特征向量稀疏化。

· IV指标：风控模型中，通常求解每个变量的IV值，来定义变量的重要度，一般将阀值设定在0.02以上。

通常的做法是根据业务需求来定，如果基于业务的用户或商品特征，需要较多的解释性，考虑采用统计上的一些方法，如变量的分布曲线，直方图等，再计算相关性指标，最后去考虑一些模型方法。如果建模需要，则通常采用模型方法去筛选特征，如果用一些更为复杂的GBDT，DNN等模型，一般不做特征选择，而做特征交叉。

2、维度变换：

维度变换是将现有数据降低到更小的维度，尽量保证数据信息的完整性。楼主将介绍常用的几种有损失的维度变换方法，将大大地提高实践中建模的效率

· 主成分分析（PCA）和因子分析（FA）：PCA通过空间映射的方式，将当前维度映射到更低的维度，使得每个变量在新空间的方差最大。FA则是找到当前特征向量的公因子（维度更小），用公因子的线性组合来描述当前的特征向量。

· 奇异值分解（SVD）：SVD的降维可解释性较低，且计算量比PCA大，一般用在稀疏矩阵上降维，例如图片压缩，推荐系统。

· 聚类：将某一类具有相似性的特征聚到单个变量，从而大大降低维度。

· 线性组合：将多个变量做线性回归，根据每个变量的表决系数，赋予变量权重，可将该类变量根据权重组合成一个变量。

· 流行学习：流行学习中一些复杂的非线性方法，

 

综合家庭信息表以及家庭成员信息表，可以发现在家庭成员信息表中并没有致贫原因这一属性列，我们可以将在家庭信息表中致贫原因属性列有值的家庭认为是贫困家庭，然后将这一属性列添加到家庭成员信息表中作为是否致贫(SFZP)属性列，并将贫困家庭的成员的是否致贫(SFZP)属性列置为1，否则置为0。这里还存在着许多如名字、身份证等与结果不相关，是冗余的数据。这一步我们去除了'Unnamed: 0','MEMBER_ID','CYSFZ','YHZGX'四个属性列，，完成维度规约。最后，我们得到一个完整的有特征和标签的数据表。

 

3.2 数据变换和清洗

数据变换包括对数据进行规范化，离散化，稀疏化处理，达到适用于挖掘的目的。

\1. ![img](file:///C:\Users\锦程\AppData\Local\Temp\ksohtml2100\wps3.jpg)***\*规范化处理：\****数据中不同特征的量纲可能不一致，数值间的差别可能很大，不进行处理可能会影响到数据分析的结果，因此，需要对数据按照一定比例进行缩放，使之落在一个特定的区域，便于进行综合分析。特别是基于距离的挖掘方法，聚类，KNN，SVM一定要做规范化处理。

· ![img](file:///C:\Users\锦程\AppData\Local\Temp\ksohtml2100\wps4.jpg)最大 - 最小规范化：将数据映射到[0,1]区间， 

· Z-Score标准化：处理后的数据均值为0，方差为1， 

· ![img](file:///C:\Users\锦程\AppData\Local\Temp\ksohtml2100\wps5.jpg)Log变换：在时间序列数据中，对于数据量级相差较大的变量，通常做Log函数的变换， .

***\*2、离散化处理：\****数据离散化是指将连续的数据进行分段，使其变为一段段离散化的区间。分段的原则有基于等距离、等频率或优化的方法。数据离散化的原因主要有以下几点：

· 模型需要：比如决策树、朴素贝叶斯等算法，都是基于离散型的数据展开的。如果要使用该类算法，必须将离散型的数据进行。有效的离散化能减小算法的时间和空间开销，提高系统对样本的分类聚类能力和抗噪声能力。

· 离散化的特征相对于连续型特征更易理解。

· 可以有效的克服数据中隐藏的缺陷，使模型结果更加稳定。

等频法：使得每个箱中的样本数量相等，例如总样本n=100，分成k=5个箱，则分箱原则是保证落入每个箱的样本量=20。

等宽法：使得属性的箱宽度相等，例如年龄变量（0-100之间），可分成 [0,20]，[20,40]，[40,60]，[60,80]，[80,100]五个等宽的箱。

聚类法：根据聚类出来的簇，每个簇中的数据为一个箱，簇的数量模型给定。

***\*3、稀疏化处理：\****针对离散型且标称变量，无法进行有序的LabelEncoder时，通常考虑将变量做0，1哑变量的稀疏化处理，例如动物类型变量中含有猫，狗，猪，羊四个不同值，将该变量转换成is_猪，is_猫，is_狗，is_羊四个哑变量。若是变量的不同值较多，则根据频数，将出现次数较少的值统一归为一类'rare'。稀疏化处理既有利于模型快速收敛，又能提升模型的抗噪能力。

我们这里主要对一些离散属性，比如残疾等级、残疾类别等离散离散数据进行数据变换，修改该属性列的值。

 

3.2.1 修改某些属性列的值 

观察添加SFZP(是否致贫)属性列后的数据，可以发现表中仍然存在不便于我们去做预测的数据，以及我们不需要的属性列，例如残疾等级和残疾类别等。经过分析我们选取几个关键的属性列来进行下一步分析，这一步我们将CJDJ（残疾等级）中的”一级”、”二级”等文字评级改为对应的数字1、2等。

 

3.2.2 处理表中的空值

由于很多原因，获取信息和数据的过程中，会存在各类的原因导致可能会数据丢失和空缺。针对这些缺失值的处理方法，主要是基于变量的分布特性和变量的重要性（信息量和预测能力）采用不同的方法。主要分为以下几种：

**·** ***\*删除变量\****：若变量的缺失率较高（大于80%），覆盖率较低，且重要性较低，可以直接将变量删除。

· 定值填充：工程中常见用-9999进行替代

**·** ***\*统计量填充\****：若缺失率较低（小于95%）且重要性较低，则根据数据分布的情况进行填充。对于数据符合均匀分布，用该变量的均值填补缺失，对于数据存在倾斜分布的情况，采用中位数进行填补。

· 插值法填充：包括随机插值，多重差补法，热平台插补，拉格朗日插值，牛顿插值等

· 模型填充：使用回归、贝叶斯、随机森林、决策树等模型对缺失数据进行预测。

**·** ***\*哑变量填充\****：若变量是离散型，且不同值较少，可转换成哑变量，例如性别SEX变量，存在male,fameal,NA三个不同的值，可将该列转换成 IS_SEX_MALE, IS_SEX_**FEMALE, IS_SEX_NA。若某个变量存在十几个不同的值，可根据每个值的频数，将频数较小的值归为一类'other'，降低维度。**此做法可最大化保留变量的信息。

 

结合表中各属性含义以及实际意义，可以发现，WHCD(文化程度)属性为空应该代表的是为文盲或半文盲，我们可以通过代码将其为空的都设为0，ZXSZK（在校生状况）为空的设为0，表示不为在校生，CJLB（残疾类别）为空的设置为0，表示该家庭成员没有残疾，JKZK（健康状况）为空的设置为1，表示该家庭成员健康。

最终将各家庭成员信息按JTXX_ID（家庭ID）排序后输出到另一文件中，方便观察各个家庭的总体状况。关键代码如下：

经过该步骤处理后的部分表数据如下：

|       | JTXX_ID | ZXSZK | JKZK | CJDJ | CJLB | LDJN | SFSW | SFZP |
| ----- | ------- | ----- | ---- | ---- | ---- | ---- | ---- | ---- |
| 217   | 1       | 0     | 1    | 0    | 0    | 1    | 0    | 0    |
| 28191 | 1       | 22    | 1    | 0    | 0    | 2    | 1    | 0    |
| 34145 | 1       | 4     | 1    | 0    | 0    | 5    | 1    | 0    |
| 8915  | 1       | 0     | 1    | 0    | 0    | 2    | 1    | 0    |
| 28383 | 2       | 0     | 4    | 2    | 3    | 3    | 1    | 0    |

 

3.2.3 数据集成

数据分析任务多半涉及数据集成。数据集成将多个数据源中的数据结合成、存放在一个一致的数据存储，如数据仓库中。这些源可能包括多个数据库、数据方或一般文件。 

\1. 实体识别问题：例如，数据分析者或计算机如何才能确信一个数 据库中的 customer_id 和另一个数据库中的 cust_number 指的是同一实体?通常，数据库和数据仓库 有元数据——关于数据的数据。这种元数据可以帮助避免模式集成中的错误。

\2. 冗余问题。一个属性是冗余的，如果它能由另一个表“导出”;如年薪。属性或 维命名的不一致也可能导致数据集中的冗余。 用相关性检测冗余：数值型变量可计算相关系数矩阵，标称型变量可计算卡方检验。

\3. 数据值的冲突和处理：不同数据源，在统一合并时，保持规范化，去重。

 

观察上部分处理后的表中数据可以发现每个属性列都代表一定的含义，每个属性的值都通过数字来进行分级了，在ZXSZK（在校生状况）中数字越大表示学历越高，在JKZK（健康状况）中数字越小表示该家庭成员健康状况越好，在CJDJ（残疾等级）中数字越小表示残疾等级越低，CJLB（残疾类别）中数字越小表示残疾情况越不严重，在LDJN（劳动技能）中数字越小表示劳动技能越好，在SFSW（是否死亡）为0则为已死亡，为1则表示存活。

所以可以将各个家庭的每个成员的相同属性相加起来，作为一个家庭来进行整体分析。

处理后的表中部分数据如下：

| JTXX_ID | ZXSZK | JKZK | CJDJ | CJLB | LDJN | SFSW | SFZP |
| ------- | ----- | ---- | ---- | ---- | ---- | ---- | ---- |
| 0       | 26    | 4    | 0    | 0    | 10   | 3    | 0    |
| 1       | 0     | 4    | 2    | 3    | 3    | 1    | 0    |
| 2       | 0     | 2    | 0    | 0    | 5    | 1    | 1    |
| 3       | 0     | 6    | 2    | 3    | 9    | 2    | 0    |
| 4       | 0     | 6    | 3    | 1    | 10   | 2    | 2    |
| 5       | 6     | 16   | 9    | 9    | 27   | 7    | 0    |
| 6       | 0     | 2    | 0    | 0    | 4    | 1    | 1    |
| 7       | 0     | 8    | 6    | 7    | 8    | 2    | 0    |
| 8       | 0     | 6    | 4    | 1    | 10   | 2    | 0    |

这里是按照JTXX_ID（家庭信息ID）进行排序，有属性列ZXSZK（在校生状况）、JKZK(健康状况)、CJDJ(残疾等级)、LDJN(劳动技能)和是否(是否文盲)等属性列，是否致贫的标签列。

 

再将表中的SFZP（是否致贫）属性列不为0的值都设置为1，表示该家庭是否致贫。最终得到的数据，如下表：

|      | ZXSZK | JKZK | CJDJ | CJLB | LDJN | SFSW | SFZP |
| ---- | ----- | ---- | ---- | ---- | ---- | ---- | ---- |
| 0    | 26    | 4    | 0    | 0    | 10   | 3    | 0    |
| 1    | 0     | 4    | 2    | 3    | 3    | 1    | 0    |
| 2    | 0     | 2    | 0    | 0    | 5    | 1    | 1    |
| 3    | 0     | 6    | 2    | 3    | 9    | 2    | 0    |
| 4    | 0     | 6    | 3    | 1    | 10   | 2    | 1    |
| 5    | 6     | 16   | 9    | 9    | 27   | 7    | 0    |
| 6    | 0     | 2    | 0    | 0    | 4    | 1    | 1    |
| 7    | 0     | 8    | 6    | 7    | 8    | 2    | 0    |
| 8    | 0     | 6    | 4    | 1    | 10   | 2    | 0    |

 

 

***\*4.\*******\*数据处理后的可视化及分析\****

数据可视化是利用计算机图形学和图像处理技术，将数据转换成图形或图像在屏幕上显示出来，并进行交互处理的理论、方法和技术。数据可视化的实质是借助图形化手段，清晰有效的传达与沟通信息，使通过数据表达的内容更容易被理解。

数据可视化的主要特点是：

· 交互性。用户可以方便的以交互的方式管理和开发数据。

· 多维性。可以看到表示对象或事件的数据的多个属性或变量，而数据可以按其每一维的值，将其分类、排序、组合和显示。

· 可视性。数据可以用图像、曲线、二维图形、三维体和动画来显示，并可对其模式和相互关系进行可视化分析。

根据家庭成员信息表3.csv（未对家庭成员各信息进行合并）处理后的可视化结果

总体的健康状况-残疾类别统计图：

![img](file:///C:\Users\锦程\AppData\Local\Temp\ksohtml2100\wps6.jpg) 

从柱状图中可以看出大部分家庭中都是肢体残疾，其他类型的残疾人数总体也占了一部分。

 

分析家庭成员信息表5.csv表中致贫家庭数所占比例，可视化结果：

![img](file:///C:\Users\锦程\AppData\Local\Temp\ksohtml2100\wps7.jpg) 

从饼图中可以看出总的致贫家庭数占到了百分之2.20。

 

***\*5.\*******\*模型构建\****

模型构建是对采样数据轨迹的概括，它反映的是采样数据内部结构的一般特征，并与该采样数据的具体结构基本吻合。

预测模型的构建通常包括模型建立、模型训练、模型验证和模型预测4个步骤，但根据不同的数据挖掘分类应用会有细微的变化。

可以采取模型评价探究模型是否合适，以及不同模型之间的优劣。

模型效果评价通常分两步：

第一步，直接使用原来建立模型的样本数据来进行检验。

第二步，另找一批反映客观实际的、规律性的数据。

假如进行模型评价时第一步都通不过，那么所建立的决策支持信息价值就不太大了。

一般来说，模型评价在第一步应得到较好的反馈，从而说明我们确实从这批数据样本中挖掘出了符合实际的规律性。

在进行特征工程之后，我们一般会建立2-3个模型，来比较这几个模型在这个任务上哪个模型更好。例如：分类模型：KNN、贝叶斯分类、决策树、随机森林、SVM、逻辑回归。回归模型：简单线性回归、多重线性回归、一元非线性回归、lasso回归、岭回归。聚类模型：k-means、DBSCAN密度法、层次聚类法。一般这些模型可以直接使用sklearn中对应的模型。

 

5.1 构建Logistic逻辑回归模型

Logistic回归是一种十分常见的分类模型，是的严格来说这是一个分类模型，之所以叫做回归也是由于历史原因。不同于线性回归中对于参数的推导，我们在这里运用的方式不再是最小二乘法，而是极大似然估计。Logistic回归分析属于非线性回归，它是研究因变量为二项分类或多项分类结果与某些影响因素之间关系的一种多重回归分析方法。

 

 

1、Logistic回归建模步骤

①根据分析目的设置指标变量（因变量和自变量），然后收集数据，根据收集到的数据对特征再次进行筛选。

②y取1的概率是p=P(y=1|X)，取0的概率是1-p，用ln(p/(1-p))和自变量列出线性回归方程，估计出模型中的回归系数。

③进行模型检验。模型的有效性的检验指标有很多，最基本的有正确率，其次有混淆矩阵、ROC曲线、KS值等。

④模型应用：输入自变量的值，就可以得到预测变量的值。

 

2、参数调优：

***\*正则化参数\****：

***\*损失函数优化器\****：

 

3、模型预测结果：



5.2 构建SVM支持向量机模型

1、支持向量机建模步骤

①根据分析目的设置指标变量（因变量和自变量），然后收集数据，根据收集到的数据对特征再次进行筛选。

②使用PCA主成分分析，对特征进行筛选，这里选择的参数是6，即留下六个特征（虽然总共才七个特征）。使用make_pipeline1构建管道，实现流水化统一处理进行惩罚系数调优，加入模型进行从特征到模型的训练。

③用GridSearchCV对惩罚系数C进行自动调参，获得最优的参数和模型。这里得到的grid.best_estimator是50。

④进行模型检验。模型的有效性的检验指标有很多，最基本的有正确率，其次有混淆矩阵、ROC曲线、KS值等。

⑤模型应用：输入自变量的值，就可以得到预测变量的值。

 

2、参数调优：

***\*核函数：\****

· 线性核函数 LINEAR

· 高斯径向基核函数 RBF

· 多项式核函数 POLY

· 神经元的非线性作用核函数 Sigmoid

***\*惩罚系数\****：默认值为1.0， 错误项的惩罚系数。

 

 

3、模型预测结果：

对家庭各信息的数据情况进行支持向量机建模，通过4:1的比例将原数据集分为训练集以及测试集。再使用调优之后的模型对数据进行训练和测试，得到最优的惩罚系数是50，预测结果，以及该模型的测试平均正确率是84.2％。可以把预测结果和家庭信息ID共同写入到“家庭致贫风险表2”。